<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Contentful UI-Extension Intershop Products</title>
    <script src="https://unpkg.com/contentful-ui-extensions-sdk@3"></script>
  </head>
  <body id="intershop-widget">
    <h2>Intershop products</h2>
    <div id="content"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
      const baseUrl = 'https://cyan.fenego.zone/INTERSHOP/rest/WFS/';
      const categoriesUrl = `${baseUrl}inSPIRED-inTRONICS_Business-Site/-/categories`;

      const getCategories = async () => {
        const response = await $.get(categoriesUrl);
        const categoryUris = response.elements.map(category => `${baseUrl}${category.uri}`);
        const categories = await Promise.all(categoryUris.map(uri => $.get(uri)));

        console.log('fetched categories:', categories);

        return categories;
      };

      window.contentfulExtension.init(async extension => {
        extension.window.startAutoResizer();

        const categories = await getCategories();

        $('#content').html(`Fetched ${categories.length} categories, building interface...`);
      });
    </script>
  </body>
</html>
